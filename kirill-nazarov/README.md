# Один аккаунт для всей семьи

## Задача

Возможность общего способа оплаты для нескольких аккаунтов

## MVP

### Гипотезы

- Большее количество пользователей получат возможность самостоятельно делать заказ, что увеличит частоту заказов
- Пользователи чаще будут делать заказы со своих аккаунтов. Это предоставит сервису актуальные данные пассажира во время поездки

### Метрики

- частота заказов с семейного аккаунта

### Функционал

- Манипуляции с участниками группы
  - добавление
  - изменение данных
  - удаление
- Манипуляции со способами оплаты
  - добавление уже верифицированной карты
  - удаление
  - изменение

В полной версии можно будет добавить возможность добавление нового способа оплаты

## Архитектура

Для реализации вышеописанного функционала нам потребуется хранить платежные данные и участников группы. Т.к. информация и о тех и о других уже где-то храниться, нам потребуется хранить только ссылки.

![bl.png](./assets/bl.png)

### Добавление/удаление пользователя из группы

![memb.png](./assets/memb.png)

- Занесение/удаление ссылки на его YID в базе Members
- Добавление/удаление группового способа оплаты

### Изменение платежной информации

![paym.png](./assets/paym.png)

- Изменение состояния базы с пл инф
- Запросы на изменение способов оплаты для каждого члена группы

### API
![familyAccount.yaml](./assets/familyAccount.yaml)

## Тестирование
- UNIT: Проверить crud для участников группы и способов оплаты
-  INTEGR: проверить правильность взаимодействия с внешними сервисами
  - добавление/удаление семейного способа оплаты для пользователя
  - правильность привязки пользователя к семейному аккаунту
- STRESS: оценить увеличение нагрузки на внешние сервисы

### Corner cases
Предусмотреть ситуации

- удаление группы
  - группы не существует
  - у участника нет прав для удаления (приглашенный)
- создание группы
  - пользователь уже является участником какой-либо группы
- удаление способа оплаты
  - у участника нет прав на удаление (приглашенный)
  - запрашиваемая карта не привязана к семейному аккаунту

### Включение фичи
Включать фичу будем на ограниченную группу людей. Отбор проводится, опираясь на 

- частоту заказов для другого человека (в такси есть такая опция)
- возраст человека. Посчитать статистику, какие возрастные группы чаще всего заказывают такси кому-то ещё 
