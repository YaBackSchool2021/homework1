Фича
- Подписка на любимый маршрут

Боль:
- Повышенный коэффициент часто отталкивает от сервиса Яндекс го

Следствие:
- Выбирают общественный транспорт
- Открывают приложения с такси второго выбора(didi, gett, заказывают локальных перевозчиков. Например, в Казани «такси Татарстан»)
Едут на каршеринге

Последствия:
- Негативный осадок потому, что пришлось:
  1. потратить больше денег, ведь надо срочно доехать
  2. ехать на общественном транспорте из-за того, что кто-то захотел заработать ещё больше
- Издержки упущенной выгоды. Да, деньги, которые мы не заработаем из-за того, что клиент выбрал другой способ передвижения — наши расходы.

Гипотеза:
- Ввести подписку на путь дом — работа — дом или любую точку А и точку Б, которую пользователь сможет выбирать сам раз в неделю. Подписка — значит, что этот путь никогда не будет рассчитываться по повышенному коэффициенту и будем иметь всегда стандартную стоимость.

Зачем:
- Повысить ценность бренда и лояльность к нему у клиента на эмоциональном уровне, за счёт вполне рациональной выгоды.

MVP:
1. Для реализации данной фичи необходимо разработать новый микро сервис, который будет хранить любимый маршрут всех пользователей.
Также данный сервис возьмет на себя расчёты координат. Входят ли данные координаты в диапазон «любимого маршрута» пользователя.

2. Данный сервис должен быть интегрирован в существующие мобильное приложение для клиентов. Туда необходимо будет добавить новые кнопочки:
- Выбрать любимый маршрут
- Поехать любимым маршрутом
3. Во время формирования стоимости сервис расчётов поездки должен будет обращаться к этому сервису, чтобы узнать: Является ли данный маршрут любимым у пользователя.
4. Также для надёжности стоит хранить данные любимых поездок пользователя и в БД сервиса по расчётам стоимости, если вдруг наш сервис ляжет.


База данных:
Для данной фичи можно выбрать реляционную базу данных PostgreSQL или PostGIS — это расширитель PostgreSQL. Он добавляет поддержку географических объектов, позволяя выполнять запросы местоположения на SQL.

В БД создаём табличку с 5 полями:
- user_id — айди пользователя
- location1 — точка А
- location2 — точка Б
- install_date — дата установки. Менять любимый маршрут можно только раз в неделю.
- is_active — флаг, который показывает последний выбранный любимый маршрут. Чтобы хранить в БД предыдущие любимые маршруты пользователей.

![ScreenShot](https://github.com/YaBackSchool2021/homework1/blob/filipp/bashir-filipp/screenshots/table.png)


Архитектура:

Для данной фичи реализуем возможность пользователям выбирать и смотреть свой любимый маршрут.
![ScreenShot](https://github.com/YaBackSchool2021/homework1/blob/filipp/bashir-filipp/screenshots/add_favoriteway.png)

И возможность сервису расчёта стоимости узнать входит ли выбранный маршрут в любимый у пользователя.
![ScreenShot](https://github.com/YaBackSchool2021/homework1/blob/filipp/bashir-filipp/screenshots/check_favoriteway.png)

Описание протокола и API
Доступно в файле openapi.yaml
[a link](https://github.com/YaBackSchool2021/homework1/blob/filipp/bashir-filipp/openapi.yaml)

Тестирование:

Юнит тестирование:
- Нельзя сделать больше одного заказа за полчаса в одно направление любимого маршрута( чтобы исключить возможность заказа нескольких такси на всю компанию).
- Точка отправления совпадает с одной из точек любимого маршрута в радиусе 100 метров и также точка назначения совпадает с одной из точек любимого маршрута в радиусе 100 метров.
- Если одна точка находится в радиусе, а другая нет. То сервис должен отвечать отказом – это не любимый маршрут.
- Выбирать любимый маршрут можно не чаще, чем раз в неделю

Нагрузочное тестирование:
- Сервис должен выдерживать примерно такую же нагрузку, как и сервис по расчётам стоимости поездки. Ведь в худшем случае, каждую поездку придется проверять.

Интеграционное тестирование:
- Возможно стоит хранить кэш выбранных любимых поездок пользователей в сервисе расчёта стоимости поездки. В случае, когда сервис любимых поездок ляжет, можно будет выбрать один чёткий маршрут без погрешностей в 100 метров из точки А в точку Б, которую выбрал пользователь изначально.

- Также в случае если пользователь выбрал сначала любимый маршрут, но во время поездки решил заехать по своим делам в другие места, эта поездка должна рассчитываться, как обычная. Сервис Яндекс Го должен будет следить за такими ситуациями.

Формат включения фичи:
1. Включить фичу на работников Яндекса
2. Включить фичу на город — миллионник( Казань, Екатеринбург)

Метрики, за которыми стоит следить:
1. Количество выходов из приложения во время повышенного коэффициента в городах с фичей и без.
2. Количество заказов, которые делают пользователи в городе с фичей и без. По идее данная фича должна увеличить количество использования сервиса даже во время, когда нет повышенного коэффициента.
