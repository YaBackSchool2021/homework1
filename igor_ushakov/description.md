## Описание задачи
Необходимо добавить в приложение Яндекс GO функцию расчета рейтинга пассажира.

## Зачем
- Есть некоторые группы людей(напр. портящие имущество), которым дешевле отказать в обслуживании, чем предоставлять им услугу. Надо как то дифференцировать их с другими.
- При получении плохого опыта водителем ему нужно куда то "спустить пар" и лучше он поставит плохую оценку и его опыт улучшится, чем будет разбираться с пассажиром лично.

## Расчет рейтинга
Для расчета рейтинга можно использовать средневзвешенное от последних N поездок. Вес определяется количеством дней прошедших с даты оценки. Например 0.95**K, где K - количество дней с даты оценки. То есть более старые оценки имеют меньший вес чем новые.

## MVP
Добавляем возможность оставлять оценку. После окончания поездки для завершения заказа водителю предоставляется возможность оценить пассажира нажав на нужное количество звезд. 

В случае если количество звезд меньше либо равно 3(?) даём возможность выбрать причины низкой оценки из предложенных(грубость, порча имущества, проблемы с оплатой).

### Реализация
Выделим под эту фичу отдельный микросервис. Это будет REST-микросервис. В нем будет 1 таблица в БД postgresql - ratings, хранящая 
- client_id(int, id клиента)
- driver_id(int, id водителя)
- created_at(timestamp, дата проставления оценки)
- stars_count(int, количество звезд)
- trip_id(int, id поездки)
- additional_info(jsonb, объект с дополнительной информацией, напр. причины низкой оценки)

1 ручка:

- POST /rating/<user_id:int> - добавить оценку пользователю. Обработчик должен быть идемпотентным. Вставляет в таблицу ratings новую строку с данными об оценке(количество звезд, id водителя, дата оценки, id поездки, причины низкой оценки)

## Полная версия
В полной версии добавим возможность смотреть свой рейтинг пассажиром.

### Реализация
Добавим redis, в котором будем хранить соответствие пользователя и текущего рейтинга. Добавим в обработчик добавления оценки перерасчет рейтинга и сохранения его в redis(здесь можно было добавить очередь задач и считать рейтинг в фоне от запроса, чтобы запрос был почти мгновенным, но операция проставления оценки не так уж часта и не требует мгновенного отклика, считаю пока это оверинженирингом)

Добавим еще 1 ручку:
- GET /rating/<user_id:int> - получить оценку пользователя. Возвращает данные из redis, если данных нет то возвращаем 5(изначально рейтинг максимален)

## Тестирование

### Юнит
- добавление оценки обновляет рейтинг в redis
- нельзя добавить 2 оценки по одному trip_id
- нельзя добавить оценку с несоответствуещими trip_id, driver_id, client_id

## Эксперименты
Сначала включаем на один или несколько регионов, следим за оттоком водителей(он должен уменьшаться)